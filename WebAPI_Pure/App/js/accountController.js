!function(){"use strict";angular.module("app").controller("registerAndLoginCtrl",["user","userAccount","changePass","$scope","$location","currentUser",function(e,t,o,n,s,r){function a(e){e.target==c?(c.style.display="none",window.removeEventListener("click",a)):e.target==l&&(l.style.display="none",window.removeEventListener("click",a))}var i=this,c=document.getElementById("reg"),l=document.getElementById("login");i.displayReg=function(){window.addEventListener("click",a),c.style.display="block"},i.displayLogin=function(){window.addEventListener("click",a),l.style.display="block"},i.exitModal=function(){c.style.display="none",l.style.display="none",window.removeEventListener("click",a)},i.show=!1,i.phaseOneHide=!1,i.formData={},i.regForm=function(){e.save(i.formData,function(e){console.log(e),i.formData={},n.regForm.$setPristine()})},i.userData={},i.login=function(){i.userData.grant_type="password",i.userData.confirmPassword=i.userData.password,i.userData.userName=i.userData.email,t.loginUser(i.userData,function(e,t){r.setProfile(e.userName,!0,e.roles),sessionStorage.setItem("access_token",e.access_token),"Admin"==e.roles?s.path("/Admin"):(e.roles="User")?s.path("/User"):s.path("/Login")},function(e){i.errorMsg=e.statusText}),window.removeEventListener("click",a)},i.forgotPassword=function(){window.removeEventListener("click",a),s.path("/ForgotPassword")}}]).controller("changePswCtrl",["$scope","changePass",function(e,t){var o=this;o.formData={},o.changePassword=function(){t.update(o.formData,function(t){t.Succeeded&&(o.formData={},e.changeForm.$setPristine(),o.msg="Lösenordet ändrat.")},function(e){o.errorMsg=e.statusText})}}]).controller("forgotPassCtrl",["$scope","fp",function(e,t){var o=this;o.formData={},o.msg="",o.validMsg=!1,o.send=function(){t.get(o.formData,function(t){o.msg="Länken är nu skickad till den angivna eposten.",o.validMsg=!0,o.formData={},e.forgotForm.$setPristine()},function(e){o.errorMsg=e.statusText})}}]).controller("recoverPassCtrl",["rp","$routeParams","$location",function(e,t,o){var n=this;n.formData={ID:t.userId,Code:t.code,Email:"",Password:"",ConfirmPassword:""},n.confirmNewPass=function(){e.post(n.formData,function(e){o.path("/Login")},function(e){n.errorMsg=e.statusText})}}]).controller("confirmMailCtrl",["cm","$routeParams",function(e,t){var o=this;e.get({userId:t.userId,code:t.code},function(e){console.log(e[0]),"C"==e[0]?o.cmMsg="Tack, Du har nu bekräftat din epost.":o.cmMsg="Något gick fel, försök igen."},function(e){o.errorMsg=e.statusText})}])}();