!function(){"use strict";angular.module("app").controller("registerAndLoginCtrl",["user","userAccount","changePass","$scope","$location","currentUser",function(e,t,o,r,n,s){function a(e){e.target==c?(c.style.display="none",window.removeEventListener("click",a)):e.target==u&&(u.style.display="none",window.removeEventListener("click",a))}var i=this,c=document.getElementById("reg"),u=document.getElementById("login");i.displayReg=function(){window.addEventListener("click",a),c.style.display="block"},i.displayLogin=function(){window.addEventListener("click",a),u.style.display="block"},i.exitModal=function(){c.style.display="none",u.style.display="none",window.removeEventListener("click",a)},i.show=!1,i.phaseOneHide=!1,i.formData={},i.regForm=function(){e.save(i.formData,function(e){i.errorMsg="",i.formData={},i.regMsg="Tack för registreringen.",r.regForm.$setPristine()},function(e){i.errorMsg=e.statusText})},i.userData={},i.login=function(){i.userData.grant_type="password",i.userData.confirmPassword=i.userData.password,i.userData.userName=i.userData.email,t.loginUser(i.userData,function(e,t){s.setProfile(e.userName,!0,e.roles,e.confirm),sessionStorage.setItem("access_token",e.access_token),"Admin"==e.roles?n.path("/Admin"):(e.roles="User")?n.path("/User"):n.path("/Login")},function(e){i.errorMsg=e.statusText})},i.forgotPassword=function(){n.path("/ForgotPassword")}}]).controller("changePswCtrl",["$scope","changePass",function(e,t){var o=this;o.formData={},o.changePassword=function(){t.update(o.formData,function(t){t.Succeeded&&(o.formData={},e.changeForm.$setPristine(),o.msg="Lösenordet ändrat.")},function(e){o.errorMsg=e.statusText})}}]).controller("forgotPassCtrl",["$scope","fp",function(e,t){var o=this;o.formData={},o.msg="",o.validMsg=!1,o.send=function(){t.get(o.formData,function(t){o.msg="Länken är nu skickad till den angivna eposten.",o.validMsg=!0,o.formData={},e.forgotForm.$setPristine()},function(e){o.errorMsg=e.statusText})}}]).controller("recoverPassCtrl",["rp","$routeParams","$location",function(e,t,o){var r=this;r.formData={ID:t.userId,Code:t.code,Email:"",Password:"",ConfirmPassword:""},r.confirmNewPass=function(){e.post(r.formData,function(e){o.path("/Login")},function(e){r.errorMsg=e.statusText})}}]).controller("confirmMailCtrl",["cm","$routeParams",function(e,t){var o=this;e.get({userId:t.userId,code:t.code},function(e){"C"==e[0]?o.cmMsg="Tack, Du har nu bekräftat din epost.":o.cmMsg="Något gick fel, försök igen."},function(e){o.errorMsg=e.statusText})}]).directive("compareTo",function(){return{require:"ngModel",scope:{confirmPassword:"=compareTo"},link:function(e,t,o,r){r.$validators.compareTo=function(t){return t==e.confirmPassword},e.$watch("confirmPassword",function(){r.$validate()})}}})}();