!function(){"use strict";angular.module("app").controller("registerAndLoginCtrl",["user","userAccount","changePass","$scope","$location","currentUser",function(o,n,e,t,r,s){function a(o){o.target==l?(l.style.display="none",window.removeEventListener("click",a)):o.target==c&&(c.style.display="none",window.removeEventListener("click",a))}var i=this,l=document.getElementById("reg"),c=document.getElementById("login");i.displayReg=function(){window.addEventListener("click",a),l.style.display="block"},i.displayLogin=function(){window.addEventListener("click",a),c.style.display="block",l.style.display="none"},i.exitModal=function(){l.style.display="none",c.style.display="none",window.removeEventListener("click",a)},i.show=!1,i.phaseOneHide=!1,i.loadingMsg="",i.loadingBool=!1,i.formData={},i.regForm=function(){i.loadingBool=!0,i.loadingMsg="Registrering pågår...",o.save(i.formData,function(o){i.errorMsg="",i.formData={},i.regMsg="Du är nu registrerad och kan nu logga in och välja dina trycksaker.",t.regForm.$setPristine(),i.loadingBool=!1,i.loadingMsg=""},function(o){i.regErrorMsg=o.statusText,i.loadingBool=!1,i.loadingMsg=""})},i.userData={},i.login=function(){i.userData.grant_type="password",i.userData.confirmPassword=i.userData.password,i.userData.userName=i.userData.email,n.loginUser(i.userData,function(o,n){s.setProfile(o.userName,!0,o.roles,o.confirm),sessionStorage.setItem("access_token",o.access_token),"Admin"==o.roles?r.path("/Admin"):(o.roles="User")?r.path("/User"):r.path("/Login")},function(o){i.errorMsg=o.statusText})},i.forgotPassword=function(){r.path("/ForgotPassword")}}]).controller("changePswCtrl",["$scope","changePass",function(o,n){var e=this;e.formData={},e.loadingMsg="",e.loadingBool=!1,e.changePassword=function(){e.loadingMsg="Ändrar lösenordet...",e.loadingBool=!0,n.update(e.formData,function(n){n.Succeeded&&(e.formData={},o.changeForm.$setPristine(),e.msg="Lösenordet ändrat.",e.loadingMsg="",e.loadingBool=!1)},function(o){e.errorMsg=o.statusText,e.loadingMsg="",e.loadingBool=!1})}}]).controller("forgotPassCtrl",["$scope","fp",function(o,n){var e=this;e.formData={},e.msg="",e.validMsg=!1,e.loadingMsg="",e.loadingBool=!1,e.send=function(){e.loadingMsg="Länken skickas...",e.loadingBool=!0,n.get(e.formData,function(n){e.msg="Länken är nu skickad till den angivna eposten.",e.validMsg=!0,e.formData={},o.forgotForm.$setPristine(),e.loadingMsg="",e.loadingBool=!1},function(o){e.errorMsg=o.statusText,e.loadingMsg="",e.loadingBool=!1})}}]).controller("recoverPassCtrl",["rp","$routeParams","$location",function(o,n,e){var t=this;t.formData={ID:n.userId,Code:n.code,Email:"",Password:"",ConfirmPassword:""},t.confirmNewPass=function(){o.post(t.formData,function(o){e.path("/Login")},function(o){t.errorMsg=o.statusText})}}]).controller("confirmMailCtrl",["cm","$routeParams",function(o,n){var e=this;o.get({userId:n.userId,code:n.code},function(o){"C"==o[0]?e.cmMsg="Tack, Du har nu bekräftat din epost.":e.cmMsg="Något gick fel, försök igen."},function(o){e.errorMsg=o.statusText})}]).directive("compareTo",function(){return{require:"ngModel",scope:{confirmPassword:"=compareTo"},link:function(o,n,e,t){t.$validators.compareTo=function(n){return n==o.confirmPassword},o.$watch("confirmPassword",function(){t.$validate()})}}})}();