!function(){"use strict";angular.module("app").controller("adminCtrl",["printMsg","user","userPage","currentUser","searchUser",function(e,r,t,a,s){function n(e){t.query({take:e,page:l+1},function(e){e.length>0?i.displayLoadMore=!0:i.displayLoadMore=!1},function(e){i.errorMsg=e.statusText})}var i=this;i.users=[],i.take=25;var l=1,o=!0;i.hasSearch=!1,i.errorMsg="",i.btnText="Ladda fler",i.disableDuringLoad=!0,i.firstUsers=function(e){l=1,i.disableDuringLoad=!0,i.btnText="Laddar...",t.query({take:e,page:l},function(e){angular.copy(e,i.users),i.disableDuringLoad=!1,i.btnText="Ladda fler"},function(e){console.log(e),i.errorMsg=e.statusText}),n(e)},i.firstUsers(i.take),console.log(i.users),i.loadMoreUsers=function(e){i.hasSearch?(i.firstUsers(e),i.hasSearch=!1):(i.isRefreshed||i.refreshUserList(),l+=1,i.disableDuringLoad=!0,i.btnText="Laddar...",t.query({take:e,page:l},function(e){for(var r=0;r<e.length;r++)i.users.push(e[r]),i.btnText="Ladda fler",i.disableDuringLoad=!1},function(e){i.errorMsg=e.statusText}),n(e))};var c;i.selectUser=function(e){for(var r=0;r<i.users.length;r++)i.users[r].Id==e&&(i.selUser=i.users[r],c=JSON.parse(JSON.stringify(i.selUser)))},i.cancleUserEdit=function(e){for(var r=0;r<i.users.length;r++)i.users[r].Id==e&&(i.users[r]=c);i.selUser=""},i.saveUserEdit=function(e){console.log(i.selUser),r.update({id:e},i.selUser,function(e){o=!1,i.disableDuringLoad=!1},function(e){i.errorMsg=e.statusText}),i.selUser=""},i.deleteUser=function(e){confirm("Vill du verkligen ta bort personen från Databasen?")&&r.delete({id:e},function(r){for(var t,a=0;a<i.users.length;a++)i.users[a].Id==e&&(t=a);i.users.splice(t,1)},function(e){i.errorMsg=e.statusText})},i.refreshUserList=function(){o=!0,i.disableDuringLoad=!0,i.btnText="Ladda fler",i.hasSearch=!1,i.users=[];for(var e=1;e<l+1;e++)i.btnText="Laddar...",t.query({take:i.take,page:e},function(e){for(var r=0;r<e.length;r++)i.users.push(e[r]),i.btnText="Ladda fler",i.disableDuringLoad=!1;i.users.sort(function(e,r){return e.DistrictNumber-r.DistrictNumber})},function(e){i.errorMsg=e.statusText})},i.searchUser=function(e){i.displayLoadMore=!1,i.disableDuringLoad=!0,i.hasSearch=!0,i.users=[],i.btnText="Laddar...",s.stringSearch.query({query:e},function(e){angular.copy(e,i.users),i.disableDuringLoad=!1},function(e){i.errorMsg=e.statusText})},i.searchDistrict=function(e){i.displayLoadMore=!1,i.disableDuringLoad=!0,i.hasSearch=!0,i.users=[],i.btnText="Laddar...",s.districtSearch.query({query:e},function(e){angular.copy(e,i.users),i.disableDuringLoad=!1},function(e){i.errorMsg=e.statusText})}}]).controller("adminCreateCtrl",["adminCreate",function(e){var r=this;r.activeCat=!0,r.formDataCat={ID:0,Active:r.activeCat},r.saveFormCat=function(){e.cats.create(r.formDataCat,function(t){e.cats.get(function(e){angular.copy(e,r.cats)}),r.formDataCat={ID:0,Active:r.activeCat}})},r.cats=[],e.cats.get(function(e){angular.copy(e,r.cats)}),r.activeFlyer=!0,r.selectedCat={ID:1},r.formDataFlyer={ID:0,Active:r.activeFlyer},r.saveFormFlyer=function(){r.formDataFlyer.CategoryID=r.selectedCat.ID,e.flyers.create(r.formDataFlyer,function(t){r.formDataFlyer={ID:0,Active:r.activeFlyer},e.flyers.get(function(e){e.length>0&&angular.copy(e,r.flyers)})})},r.flyers=[],e.flyers.get(function(e){e.length>0&&angular.copy(e,r.flyers)}),r.displayCats=!1,r.displayFlyers=!1,r.editMode=!1,r.catClick=function(){r.displayCats=!0,r.displayFlyers=!1},r.flyerClick=function(){r.displayCats=!1,r.displayFlyers=!0};var t;r.editCats=function(e){r.editMode=!0;for(var a=0;a<r.cats.length;a++)r.cats[a].ID==e&&(r.selCat=r.cats[a],t=JSON.parse(JSON.stringify(r.selCat)))},r.editFlyer=function(e){r.editMode=!0;for(var a=0;a<r.flyers.length;a++)r.flyers[a].ID==e&&(r.selFlyer=r.flyers[a],t=JSON.parse(JSON.stringify(r.selFlyer)))},r.saveCatEdits=function(t){e.cats.update({id:t},r.selCat,function(e){r.editMode=!1}),r.selCat=""},r.saveFlyerEdits=function(t){r.selFlyer.CategoryID=r.selectedCat.ID,console.log(r.selFlyer),e.flyers.update({id:t},r.selFlyer,function(e){r.editMode=!1}),r.selFlyer=""},r.cancleCat=function(){for(var e=0;e<r.cats.length;e++)r.cats[e].ID==id&&(r.cats[e]=t);r.selCat=""},r.cancleFlyer=function(e){for(var a=0;a<r.flyers.length;a++)r.flyers[a].ID==e&&(r.flyers[a]=t);r.selFlyer=""},r.deleteCat=function(t){if(confirm("Vill du verkligen ta bort kategorin från Databasen? Detta kommer också ta bort alla reklamblad för kategorin!")){for(var a=0;a<r.flyers.length;a++)r.flyers[a].Category.ID==t&&e.flyers.delete({id:r.flyers[a].ID},function(e){r.flyers.splice(t,1)});e.cats.delete({id:t},function(e){r.cats.splice(t,1)})}},r.deleteFlyer=function(t){confirm("Vill du verkligen ta bort reklambladet från Databasen?")&&e.flyers.delete({id:t},function(a){r.flyers.splice(t,1),e.flyers.get(function(e){angular.copy(e,r.flyers)})})}}])}();