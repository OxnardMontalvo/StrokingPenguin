!function(){"use strict";angular.module("app").controller("adminCtrl",["printMsg","user","userPage","currentUser","searchUser",function(e,r,t,a,s){function n(e){t.query({take:e,page:i+1},function(e){e.length>0?l.displayLoadMore=!0:l.displayLoadMore=!1},function(e){l.errorMsg=e.statusText})}var l=this;l.users=[],l.take=25;var i=1,o=!0;l.hasSearch=!1,l.errorMsg="",l.btnText="Ladda fler",l.disableDuringLoad=!0,l.firstUsers=function(e){i=1,l.disableDuringLoad=!0,l.btnText="Laddar...",t.query({take:e,page:i},function(e){angular.copy(e,l.users),l.disableDuringLoad=!1,l.btnText="Ladda fler"},function(e){console.log(e),l.errorMsg=e.statusText}),n(e)},l.firstUsers(l.take),console.log(l.users),l.loadMoreUsers=function(e){l.hasSearch?(l.firstUsers(e),l.hasSearch=!1):(l.isRefreshed||l.refreshUserList(),i+=1,l.disableDuringLoad=!0,l.btnText="Laddar...",t.query({take:e,page:i},function(e){for(var r=0;r<e.length;r++)l.users.push(e[r]),l.btnText="Ladda fler",l.disableDuringLoad=!1},function(e){l.errorMsg=e.statusText}),n(e))};var c;l.selectUser=function(e){for(var r=0;r<l.users.length;r++)l.users[r].Id==e&&(l.selUser=l.users[r],c=JSON.parse(JSON.stringify(l.selUser)))},l.cancleUserEdit=function(e){for(var r=0;r<l.users.length;r++)l.users[r].Id==e&&(l.users[r]=c);l.selUser=""},l.saveUserEdit=function(e){console.log(l.selUser),r.update({id:e},l.selUser,function(e){o=!1,l.disableDuringLoad=!1},function(e){l.errorMsg=e.statusText}),l.selUser=""},l.deleteUser=function(e){confirm("Vill du verkligen ta bort personen från Databasen?")&&r.delete({id:e},function(r){for(var t,a=0;a<l.users.length;a++)l.users[a].Id==e&&(t=a);l.users.splice(t,1)},function(e){l.errorMsg=e.statusText})},l.refreshUserList=function(){o=!0,l.disableDuringLoad=!0,l.btnText="Ladda fler",l.hasSearch=!1,l.users=[];for(var e=1;e<i+1;e++)l.btnText="Laddar...",t.query({take:l.take,page:e},function(e){for(var r=0;r<e.length;r++)l.users.push(e[r]),l.btnText="Ladda fler",l.disableDuringLoad=!1;l.users.sort(function(e,r){return e.DistrictNumber-r.DistrictNumber})},function(e){l.errorMsg=e.statusText})},l.searchUser=function(e){l.displayLoadMore=!1,l.disableDuringLoad=!0,l.hasSearch=!0,l.users=[],l.btnText="Laddar...",s.stringSearch.query({query:e},function(e){angular.copy(e,l.users),l.disableDuringLoad=!1},function(e){l.errorMsg=e.statusText})},l.searchDistrict=function(e){l.displayLoadMore=!1,l.disableDuringLoad=!0,l.hasSearch=!0,l.users=[],l.btnText="Laddar...",s.districtSearch.query({query:e},function(e){angular.copy(e,l.users),l.disableDuringLoad=!1},function(e){l.errorMsg=e.statusText})}}]).controller("adminCreateCtrl",["adminCreate",function(e){function r(r){for(var a=0;a<t.flyers.length;a++)t.flyers[a].Category.ID==r&&e.flyers.delete({id:t.flyers[a].ID},function(e){t.flyers.splice(r,1)});return!0}var t=this;t.activeCat=!0,t.formDataCat={ID:0,Active:t.activeCat},t.saveFormCat=function(){e.cats.create(t.formDataCat,function(r){e.cats.get(function(e){angular.copy(e,t.cats)}),t.formDataCat={ID:0,Active:t.activeCat}})},t.cats=[],e.cats.get(function(e){angular.copy(e,t.cats)}),t.activeFlyer=!0,t.selectedCat={ID:1},t.formDataFlyer={ID:0,Active:t.activeFlyer},t.saveFormFlyer=function(){t.formDataFlyer.CategoryID=t.selectedCat.ID,e.flyers.create(t.formDataFlyer,function(r){t.formDataFlyer={ID:0,Active:t.activeFlyer},e.flyers.get(function(e){e.length>0&&angular.copy(e,t.flyers)})})},t.flyers=[],e.flyers.get(function(e){e.length>0&&angular.copy(e,t.flyers)}),t.displayCats=!1,t.displayFlyers=!1,t.editMode=!1,t.catClick=function(){t.displayCats=!0,t.displayFlyers=!1},t.flyerClick=function(){t.displayCats=!1,t.displayFlyers=!0};var a;t.editCats=function(e){t.editMode=!0;for(var r=0;r<t.cats.length;r++)t.cats[r].ID==e&&(t.selCat=t.cats[r],a=JSON.parse(JSON.stringify(t.selCat)))},t.editFlyer=function(e){t.editMode=!0;for(var r=0;r<t.flyers.length;r++)t.flyers[r].ID==e&&(t.selFlyer=t.flyers[r],a=JSON.parse(JSON.stringify(t.selFlyer)))},t.saveCatEdits=function(r){e.cats.update({id:r},t.selCat,function(e){t.editMode=!1}),t.selCat=""},t.saveFlyerEdits=function(r){t.selFlyer.CategoryID=t.selectedCat.ID,console.log(t.selFlyer),e.flyers.update({id:r},t.selFlyer,function(e){t.editMode=!1}),t.selFlyer=""},t.cancleCat=function(){for(var e=0;e<t.cats.length;e++)t.cats[e].ID==id&&(t.cats[e]=a);t.selCat=""},t.cancleFlyer=function(e){for(var r=0;r<t.flyers.length;r++)t.flyers[r].ID==e&&(t.flyers[r]=a);t.selFlyer=""},t.deleteCat=function(a){confirm("Vill du verkligen ta bort kategorin från Databasen? Detta kommer också ta bort alla reklamblad för kategorin!")&&r(a)&&(e.flyers.get(function(e){e.length>0&&angular.copy(e,t.flyers)}),e.cats.delete({id:a},function(r){t.cats.splice(a,1),e.cats.get(function(e){angular.copy(e,t.cats)})}))},t.deleteFlyer=function(r){confirm("Vill du verkligen ta bort reklambladet från Databasen?")&&e.flyers.delete({id:r},function(a){t.flyers.splice(r,1),e.flyers.get(function(e){angular.copy(e,t.flyers)})})}}])}();